<%@ page import="java.sql.*" %>

<html>
<body>

<p>Hello World !! Welcome to JSP</p>
<h1>Welcome to Sanjivani College of Engineering, IT Department</h1>

<form method="post">
    <h2>Enter Student Details</h2>
    Name: <input type="text" name="name" required><br><br>
    Class: <input type="text" name="class" required><br><br>
    Division: <input type="text" name="division" required><br><br>
    City: <input type="text" name="city" required><br><br>
    <input type="submit" value="Insert Record">
</form>

<hr>

<%

    String name = request.getParameter("name");
    String className = request.getParameter("class"); 
    String division = request.getParameter("division");
    String city = request.getParameter("city");

    try {
        Class.forName("com.mysql.jdbc.Driver");
        Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/pragati", "root", "");
        Statement stmt = con.createStatement();

        if (name != null && className != null && division != null && city != null) {
            
            String insertQuery = "INSERT INTO student_info (Name, Class, Division, City) VALUES ('" + name + "', '" + className + "', '" + division + "', '" + city + "')";
            int insertStatus = stmt.executeUpdate(insertQuery);

            if (insertStatus > 0) {
                out.println("<p style='color:green;'>Record inserted successfully!</p>");
            } else 
            {
                out.println("<p style='color:red;'>Record insertion failed.</p>");
            }
        }

       
%>

<table border='5'>
<tr><th>ID</th><th>Name</th><th>Class</th><th>Division</th><th>City</th></tr>

<%
        ResultSet rs = stmt.executeQuery("SELECT * FROM student_info");
        while (rs.next()) {
            out.println("<tr>");
            out.println("<td>" + rs.getInt("id") + "</td>");
            out.println("<td>" + rs.getString("Name") + "</td>");
            out.println("<td>" + rs.getString("Class") + "</td>");
            out.println("<td>" + rs.getString("Division") + "</td>");
            out.println("<td>" + rs.getString("City") + "</td>");
            out.println("</tr>");
        }
        
        rs.close();
        stmt.close();
        con.close();
    } catch (Exception e) { 
        out.print("<p style='color:red;'>Error: " + e.getMessage() + "</p>");
    } 
%>

</table>

</body>
</html>





<%@ page import="java.sql.*" %>
<html>
<body>

<h1>Welcome to Sanjivani College of Engineering, IT Department</h1>

<%
    String name = request.getParameter("name");
    String className = request.getParameter("class"); 
    String division = request.getParameter("division");
    String city = request.getParameter("city");
    String action = request.getParameter("action");
    String id = request.getParameter("id");

    try {
        Class.forName("com.mysql.jdbc.Driver");
        Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/pragati", "root", "");
        Statement stmt = con.createStatement();

        if ("insert".equals(action) && name != null && className != null && division != null && city != null) {
            String query = "INSERT INTO student_info (Name, Class, Division, City) VALUES ('" + name + "', '" + className + "', '" + division + "', '" + city + "')";
            stmt.executeUpdate(query);
            out.println("Record inserted!");
        }

        if ("delete".equals(action) && id != null) {
            stmt.executeUpdate("DELETE FROM student_info WHERE id=" + id);
            out.println("Record deleted!");
        }

        if ("update".equals(action) && id != null && name != null && className != null && division != null && city != null) {
            String query = "UPDATE student_info SET Name='" + name + "', Class='" + className + "', Division='" + division + "', City='" + city + "' WHERE id=" + id;
            stmt.executeUpdate(query);
            out.println("Record updated!");
        }

        if ("edit".equals(action) && id != null) {
            ResultSet editRs = stmt.executeQuery("SELECT * FROM student_info WHERE id=" + id);
            if (editRs.next()) 
            {
%>
                        <form method="post">
                            <input type="hidden" name="action" value="update">
                            <input type="hidden" name="id" value="<%= editRs.getInt("id") %>">
                            Name: <input type="text" name="name" value="<%= editRs.getString("Name") %>" required><br>
                            Class: <input type="text" name="class" value="<%= editRs.getString("Class") %>" required><br>
                            Division: <input type="text" name="division" value="<%= editRs.getString("Division") %>" required><br>
                            City: <input type="text" name="city" value="<%= editRs.getString("City") %>" required><br>
                            <input type="submit" value="Update">
                        </form>
                        <%
            }
            editRs.close();
        } 
        else {
                    %>
                    <form method="post">
                        <input type="hidden" name="action" value="insert">
                        Name: <input type="text" name="name" required><br>
                        Class: <input type="text" name="class" required><br>
                        Division: <input type="text" name="division" required><br>
                        City: <input type="text" name="city" required><br>
                        <input type="submit" value="Insert">
                    </form>
                    <%
        }

        ResultSet rs = stmt.executeQuery("SELECT * FROM student_info");
%>
<hr>
<table border="1">
    <tr>
        <th>ID</th><th>Name</th><th>Class</th><th>Division</th><th>City</th><th>Actions</th>
    </tr>
<%
        while (rs.next()) {
%>
    <tr>
        <td><%= rs.getInt("id") %></td>
        <td><%= rs.getString("Name") %></td>
        <td><%= rs.getString("Class") %></td>
        <td><%= rs.getString("Division") %></td>
        <td><%= rs.getString("City") %></td>
        <td>
            <form method="post" style="display:inline;">
                <input type="hidden" name="action" value="edit">
                <input type="hidden" name="id" value="<%= rs.getInt("id") %>">
                <input type="submit" value="Edit">
            </form>
            <form method="post" style="display:inline;" onsubmit="return confirm('Are you sure?');">
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="id" value="<%= rs.getInt("id") %>">
                <input type="submit" value="Delete">
            </form>
        </td>
    </tr>
<%
        }
        rs.close();
        stmt.close();
        con.close();
    } catch (Exception e) {
        out.println("Error: " + e.getMessage());
    }
%>
</table>

</body>
</html>
